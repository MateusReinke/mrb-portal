<!DOCTYPE html>
<html>
<head>
  <title>Admin - Portal MRB</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>√Årea Administrativa</h2>

<div id="loginBox">
  <input type="password" id="password" placeholder="Senha">
  <button onclick="login()">Entrar</button>
</div>

<div id="editor" style="display:none;">
  <textarea id="jsonEditor" rows="20"></textarea>
  <button onclick="save()">Salvar</button>
</div>

<script>
let token = null;

async function login(){
  const password = document.getElementById("password").value;
  const res = await fetch('/login',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({password})
  });
  if(!res.ok){ alert("Senha incorreta"); return; }
  const data = await res.json();
  token = data.token;

  document.getElementById("loginBox").style.display="none";
  document.getElementById("editor").style.display="block";

  loadCards();
}

async function loadCards(){
  const res = await fetch('/cards');
  const data = await res.json();
  document.getElementById("jsonEditor").value = JSON.stringify(data,null,2);
}

async function save(){
  const newData = JSON.parse(document.getElementById("jsonEditor").value);
  await fetch('/cards',{
    method:'POST',
    headers:{
      'Content-Type':'application/json',
      'Authorization':token
    },
    body:JSON.stringify(newData)
  });
  alert("Salvo com sucesso");
}
</script>

</body>
</html>
